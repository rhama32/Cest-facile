<div class="container">
      <!--ジャンル検索-->
      <%= render 'genrevar', genres: @genres %>
</div>
<div class="container">
      <h4><%= @hospital.name %>
      <%= @hospital.impressionist_count %>
      <div class="container text-right">
       <%= link_to "レビューを書く", new_public_hospital_review_path(@hospital), class: "btn btn-primary", data: {"turbolinks" => false} %>
      <%= link_to 'ネットde診療予約に進む', new_public_reservation_path, class: "btn btn-success" %>
      </h4>
      
                      <!--レビュー評価<div class="eval-star"><%#= hospital.reviews.doctor_satisfaction %>/5点</div>-->
              <div class="average-score mb-3">
                <div class="star-rating ml-2">
                  <div class="star-rating-front" style="width: <%= hospital.reviews.doctor_satisfaction.avg_score_percentage %>%">★★★★★
                  </div>
                    <div class="star-rating-back">★★★★★
                    </div>
                </div>
                <div class="average-score-display">
                （<%= hospital.reviews.doctor_satisfaction.avg_score_percentage %>点）
                </div>
              </div>
      
      
      
      <table class="table table-bordered table-hover">
        <tbody>
          <tr>
            <td><%= image_tag @hospital.image, class:"img-fluid d-block mx-auto", size:"200x200" %></td>
          </tr>
          <tr>
            <td>郵便番号</td>
            <td><%= @hospital.postal_code %></td>
          </tr>
          <tr>
            <td>病院名</td>
            <td><%= @hospital.name %></td>
          </tr>
          <tr>
            <td>病院名（カナ）</td>
            <td><%= @hospital.hospital_name_kana %></td>
          </tr>
          <tr>
            <td>医師名</td>
            <td><% @hospital.doctors.each do |doctor| %>
                <%= doctor.name %>
                <% if customer_signed_in? %>
                <% if current_customer.following?(doctor) %>
                  <%= link_to "フォロー外す", public_follows_path(doctor_id: doctor.id), method: :delete %>
                <% else %>
                  <%= link_to "フォローする", public_follows_path(doctor_id: doctor.id), method: :post %>
                <% end %>
              <% end %>
              <% end %>
              <%= link_to '医師一覧画面に進む', public_hospital_hospital_doctors_path(@hospital), class: "btn btn-success" %>
            </td>
          </tr>
          </tr>
          <tr>
            <td>病院説明</td>
            <td><%= @hospital.introduction %></td>
          </tr>
          <tr>
            <td>電話番号</td>
            <td><%= @hospital.telephone_number %></td>
          </tr>
          <tr>
            <td>ジャンル</td>
            <td><%= @hospital.genre.name %></td>
          </tr>
          <tr>
            <td>診療科目</td>
            <td><%= @hospital.subject %> </td>
          </tr>
          <tr>
            <td>診療時間</td>
            <td><%= @hospital.hospital_time %> </td>
          </tr>
          <tr>
            <td>駐車場</td>
            <td><%= @hospital.parking %></td>
          </tr>
          <tr>
            <td>ステータス</td>
            <td>
              <% if @hospital.is_active == true %>
                対応中
              <% else %>
                対応停止中
              <% end %>
            </td>
          </tr>
      <!--Googleマップの記載 89行目までと101行目から-->
          <tr>
            <td>Googleマップ</td>
          <td>
            <input id="address" type="textbox" value="検索バー">
            <input type="button" value="Encode" onclick="codeAddress()">
              <div id="display">検索後は表示までしばらくお待ちください。</div>
              <div id='map'></div>
          </td>
          </tr>
        </tbody>
      </table>
      <%= link_to '病院一覧画面に戻る', public_hospitals_path, class: "btn btn-primary" %>

<!--Googleマップの記載-->
<style>
#map {
  height: 400px;
  width: 400px;
}
</style>

<script>

let map
let geocoder
const display = document.getElementById('display')

function initMap(){
  geocoder = new google.maps.Geocoder()
  test ={lat: <%= @hospital.latitude %>, lng: <%= @hospital.longitude %>};
  //test = {lat: 34.73348, lng:135.500109}

  map = new google.maps.Map(document.getElementById('map'), {
    //latが緯度、lngが経度
    center: test,
    //数値は0〜21まで指定できます。数値が大きいほど拡大
    zoom: 12,
  });
   //positionに指定した座標にピンを表示
  marker = new google.maps.Marker({
    position:  test,
    map: map
  });
}

function codeAddress(){
  let inputAddress = document.getElementById('address').value;

  geocoder.geocode( { 'address': inputAddress}, function(results, status) {
    if (status == 'OK') {
      map.setCenter(results[0].geometry.location);
      var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
      });
      display.textContent = "検索結果：" + results[ 0 ].geometry.location
    } else {
      alert('該当する結果がありませんでした：' + status);
    }
  });
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GoogleMap_KEY']%>&callback=initMap" async defer></script>